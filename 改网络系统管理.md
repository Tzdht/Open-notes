# 网络系统管

##  Linux

### 配置主机和用户

```
hostnameclt set-hostname cshostname
useradd test
echo 'pass' | passwd --stdin test

密钥登录
免密登录方
ssh-keygen 加三个回车就行
ssh-copy-id 用户名@被免密登录方的IP (例如: user1@192.168.10.1)
然后yes 然后被免密登录方的密码

```

### 配置IP

```bash
服务端
nmcli connection modify ens160 autoconnect yes method none ipv4.addresses 172.16.100.1/24 ipv4.gateway 172.16.100.254 ipv4.dns 127.0.0.1
nmcli connection down ens160
nmcli connection up ens160
客户端
nmcli connection modify ens160 autoconnect yes method none ipv4.addresses 172.16.100.10/24 ipv4.gateway 172.16.100.254 ipv4.dns 172.16.100.1
nmcli connection down ens160
nmcli connection up ens160
```

### 配置Yum源

```bash
rm -rf /etc/yum.repos.d/*
mkdir /mnt/iso
echo '/dev/sr0 /mnt/iso iso9660 defaults 0 0' >> /etc/fstab
mount /dev/sr0 /mnt/iso &> /dev/null
touch /etc/yum.repos.d/local.repo
echo '[local-BaseOS]
name=local-BaseOS
baseurl=file:///mnt/iso/BaseOS
enabled=1
gpgcheck=0
[local-AppStream]
name=local-AppStream
baseurl=file:///mnt/iso/AppStream
enabled=1
gpgcheck=0' >> /etc/yum.repos.d/local.repo
yum clean all &> /dev/null
yum repolist all
yum makecache

```

### 关闭SeLinux和firewalld

```bash
systemctl stop firewalld
systemctl disable firewalld
setenforce 0
sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config
cat /etc/selinux/config

```

### 配置Samba

```bash
dnf install samba samba-client -yq
groupadd jsj #创建用户组
useradd -G jsj jsj01 #创建用户
useradd -G jsj jsj02 #创建用户
echo "password" | passwd --stdin jsj01 #配置用户名密码
echo "password" | passwd --stdin jsj02 #配置用户名密码
mkdir -p /smb/share/public /smb/share/jsj  #创建共享目录
touch /smb/share/public/p.txt /smb/share/jsj/j.txt  #创建测试文件
chmod -R 777 /smb  #修改共享目录权限
echo '
[public]
#共享名称
comment = public
#描述信息
path = /smb/share/public
#共享路径
public = yes
#所有人可见
writable = no
#是否允许写入操作
guest ok = yes
#宾客访问

[jsj]
#共享名称
comment = jsj
#描述信息
path = /smb/share/jsj
#共享路径
valid users = @jsj
#允许访问的合法用户
writable = yes
#允许写入操作
guest ok = no
#不允许宾客访问
' >> /etc/samba/smb.conf
sudo systemctl restart smb
sudo systemctl enable smb
smbpasswd -a jsj01 #需要手动设置smb密码
smbpasswd -a jsj02 #需要手动设置smb密码

客户端
dnf install samba-client -yq
匿名登录 smbclient //IP/public
用户登录 smbclient //IP/共享目录名 -U 用户名
put 上传
get 下载
	
```

### 配置DNS 记得把注释删掉再运行！！！！！！

```bash
dnf install bind bind-utils -yq
sed -i 's/{ 127.0.0.1; };/{ any; };/' /etc/named.conf
sed -i 's/{ localhost; };/{ any; };/' /etc/named.conf
echo '
zone "test.com" IN {    #域名要改
type master;
file "test.zone";  #.zone之前的名要改
};

zone "10.168.192.in-addr.arpa" IN {  #反向域名要改
type master;
file "192.168.10.arpa"; #.arpa之前的名要改
};
' >> /etc/named.rfc1912.zones
cp /var/named/named.localhost /var/named/test.zone -a  #.zone之前的名要改
cp /var/named/named.loopback /var/named/192.168.10.arpa -a  #.arpa之前的名要改
sed -i '8d;9d;10d;11d' /var/named/192.168.10.arpa  #.arpa之前的名要改
sed -i '8d;9d;10d' /var/named/test.zone  #.zone之前的名要改
echo '
    IN NS dns.test.com.  #域名要改
    IN MX 10 mail.test.com.  #域名要改
dns IN A 192.168.10.10  #IP要改
web IN A 192.168.10.10  #IP名要改
mail IN A 192.168.10.10  #IP名要改
pop3 IN A 192.168.10.10  #IP名要改
smtp IN A 192.168.10.10  #IP名要改
www IN CNAME web.test.com. #域名要改
' >> /var/named/test.zone #.zone之前的名要改
echo '
   IN NS dns.test.com. #域名要改
   IN MX 10 mail.test.com. #域名要改
10 IN PTR web.test.com. #IP和域名要改
10 IN PTR dns.test.com.  #IP和域名要改
10 IN PTR mail.test.com. #IP和域名要改
' >>/var/named/192.168.10.arpa #.arpa之前的名要改
systemctl restart named
systemctl enable named

```

### 配置DHCP 记得把注释删掉再运行！！！！！！

```bash
dnf install -yq dhcp-server
echo '
subnet 192.168.10.0 netmask 255.255.255.0 { #网段
  range 192.168.10.100 192.168.10.200; #分配范围
  option domain-name-servers 192.168.10.10; #dns服务器
  option domain-name "test.com"; #dns域名
  option routers 192.168.10.254; #网关
  default-lease-time 600; #默认过期时间
  max-lease-time 7200; #最长过期时间
}

host Client {
  hardware ethernet 08:00:07:26:c0:a5; #保留客户机的MAC地址
  fixed-address 192.168.10.150; #要保留的IP
}
' >> /etc/dhcp/dhcpd.conf
systemctl restart dhcpd
systemctl enable dhcpd

```

###  配置Apache 记得把注释删掉再运行！！！！！！

```bash
dnf install httpd -yq 
mkdir -p /web/www1 /web/www2 #创建网站目录
echo 'www1' > /web/www1/index.html #创建网页文件并设置内容
echo 'www2' > /web/www2/index.html #创建网页文件并设置内容
chmod -R 777 /web #设置网站目录权限
echo '
Listen 8080 #添加放行端口没有要求可不写

<VirtualHost 192.168.10.10:80>  #IP+端口
  Documentroot /web/www1  #网页的目录
  ServerName www1.test.com  #网页的域名
  DirectoryIndex index.html  #不用管
  <Directory /web/www1>  #网页的目录权限 改目录就行
    AllowOverride None
    Require all granted
  </Directory>
</VirtualHost>

<VirtualHost 192.168.10.10:8080> #IP+端口
  Documentroot /web/www2 #网页的目录
  ServerName www2.test.com #网页的域名
  DirectoryIndex index.html #不用管
  <Directory /web/www2>  #网页的目录权限 改目录就行
    AllowOverride None
    Require all granted
  </Directory>
</VirtualHost>
' >> /etc/httpd/conf/httpd.conf
systemctl restart httpd
systemctl enable httpd
```

### 配置Vsftpd 记得把注释删掉再运行！！！！！！

```bash
dnf install vsftpd ftp -y
mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak
grep -v "#" /etc/vsftpd/vsftpd.conf_bak > /etc/vsftpd/vsftpd.conf

#匿名访问
#setfacl -m u:ftp:rwx /var/ftp/  #此目录安装vsftpd自动创建如需要其他目录请自行创建
sed -i 's/anonymous_enable=.*/anonymous_enable=YES/' /etc/vsftpd/vsftpd.conf
echo '
anon_upload_enable=YES
anon_umask=022
anon_root=/var/ftp
anon_mkdir_write_enable=YES
anon_other_write_enable=YES
' >> /etc/vsftpd/vsftpd.conf
systemctl restart vsftpd
systemctl enable vsftpd
#客户端访问时匿名用户用户名为anonymous

#本地用户访问
useradd ftpuser1
echo 'password' | passwd --stdin ftpuser1
mkdir -p /ftpdir
chown -R ftpuser1.ftpuser1 /ftpdir
echo '
local_root=/ftpdir  #本地用户的FTP根目录
' >> /etc/vsftpd/vsftpd.conf
systemctl restart vsftpd
systemctl enable vsftpd




服务器:
dnf install vsftpd ftp -yq
mv /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf_bak 
grep -v "#" /etc/vsftpd/vsftpd.conf_bak > /etc/vsftpd/vsftpd.conf

useradd ftp01  #创建ftp用户
echo "1" | passwd --stdin ftp01  #设置用户密码
mkdir /ftp  #创建共享目录
chown -R ftp01.ftp01 /ftp #设置共享目录所属者
chmod -R 755 /ftp #设置共享目录权限

sed -i 's/anonymous_enable=.*/anonymous_enable=YES/' /etc/vsftpd/vsftpd.conf
echo '
local_root=/ftp #本地用户共享目录
anon_upload_enable=NO #是否允许上传
anon_umask=022
anon_root=/ftp #匿名用户共享目录
anon_mkdir_write_enable=NO  #是否允许创建目录
anon_other_write_enable=NO  #是否允许创建修改删除
' >> /etc/vsftpd/vsftpd.conf

systemctl restart vsftpd
systemctl enable vsftpd

客户端:
dnf install ftp -yq

ftp ip

匿名用户名:anonymous 密码空

上传命令 put 文件名
下载命令 get 文件名
创建目录 mkdir 目录名
```

### 配置Mail 记得把注释删掉再运行！！！！！！

```bash
服务端

dnf install -yq postfix dovecot telnet-server telnet
sed -i 's/^#myhostname.*virtual.domain.tld/myhostname = mail.test.com/' /etc/postfix/main.cf  #mail.test.com改成你的mail域名 例如 mail.jsj2102.com
sed -i 's/^#mydomain.*domain.tld/mydomain = test.com/' /etc/postfix/main.cf #test.com 改成你的域名 例如 jsj2102.com
sed -i 's/^#myorigin.*mydomain/myorigin = $mydomain/' /etc/postfix/main.cf
sed -i 's/^#inet_interfaces.*all/inet_interfaces = all/' /etc/postfix/main.cf
sed -i 's/^inet_interfaces.*localhost/#inet_interfaces = localhost/' /etc/postfix/main.cf
sed -i 's/^mydestination = $myhostname, localhost.$mydomain, localhost/mydestination = $myhostname, $mydomain, localhost/' /etc/postfix/main.cf

sed -i 's/^#protocols.*imap pop3 lmtp submission/protocols = imap pop3 lmtp/' /etc/dovecot/dovecot.conf
sed -i 's/^#login_trusted_networks.*/login_trusted_networks = 0.0.0.0\/0/' /etc/dovecot/dovecot.conf

sed -i 's/^#   mail_location = 
mbox:~\/mail:INBOX=\/var\/mail\/%u$/mail_location = mbox:~\/mail:INBOX=\/var\/mail\/%u/' /etc/dovecot/conf.d/10-mail.conf 

sed -i 's/^#disable_plaintext_auth = yes/disable_plaintext_auth = no/' /etc/dovecot/conf.d/10-auth.conf

sed -i 's/^ssl = required/ssl = no/' /etc/dovecot/conf.d/10-ssl.conf

useradd user1 #创建用户
useradd user2 #创建用户
echo "password" | passwd --stdin user1 #配置用户名密码
echo "password" | passwd --stdin user2 #配置用户名密码
mkdir -p /home/user1/mail/.imap/INBOX #创建邮件目录
mkdir -p /home/user2/mail/.imap/INBOX #创建邮件目录
chown user1.user1 -R /home/user1/ #修改用户目录所属者
chown user2.user2 -R /home/user2/ #修改用户目录所属者
chmod 755 -R /home/user*/ #修改目录权限

systemctl restart postfix dovecot
systemctl enable postfix dovecot


客户端
dnf install -yq telnet-server telnet

telnet 192.168.10.101 25
helo test.com #这里是你的域名
mail from:"test"<user1@test.com> #引号是你邮件的标题 里面是你的发件人名和域名
rcpt to:user2@test.com #这里是你的收件人名和域名
data
Teh first mail; user1 to user2 #这里是邮件内容 随便写
.
quit

telnet 192.168.10.101 110
user user2  #user2收件人用户名
pass password #password收件人密码
list
retr 1
quit
```

