###  DNS+Mail

```
环境：
 服务器: 172.21.7.1
 客户端: 172.21.7.10
```

```
dnf install bind bind-utils -yq
sed -i 's/{ 127.0.0.1; };/{ any; };/' /etc/named.conf
sed -i 's/{ localhost; };/{ any; };/' /etc/named.conf
echo '
zone "jsj21020110.cn" IN {
type master;
file "jsj.zone";
};

zone "7.21.172.in-addr.arpa" IN {
type master;
file "172.21.7.arpa";
};
' >> /etc/named.rfc1912.zones
cp /var/named/named.localhost /var/named/jsj.zone -a
cp /var/named/named.loopback /var/named/172.21.7.arpa -a
sed -i '8d;9d;10d;11d' /var/named/172.21.7.arpa
sed -i '8d;9d;10d' /var/named/jsj.zone
echo '
    IN NS dns.jsj21020110.cn.
    IN MX 10 mail.jsj21020110.cn.
dns IN A 172.21.7.1
web IN A 172.21.7.1
mail IN A 172.21.7.1
pop3 IN A 172.21.7.1
smtp IN A 172.21.7.1
www IN CNAME web.jsj21020110.cn.
' >> /var/named/jsj.zone
echo '
   IN NS dns.jsj21020110.cn.
   IN MX 10 mail.jsj21020110.cn.
1 IN PTR web.jsj21020110.cn.
1 IN PTR dns.jsj21020110.cn.
1 IN PTR mail.jsj21020110.cn.
1 IN PTR pop3.jsj21020110.cn.
1 IN PTR smtp.jsj21020110.cn.
' >>/var/named/172.21.7.arpa
systemctl restart named
systemctl enable named

```

```
服务端

dnf install -yq postfix dovecot telnet-server telnet
sed -i 's/^#myhostname.*virtual.domain.tld/myhostname = mail.jsj21020110.cn/' /etc/postfix/main.cf
sed -i 's/^#mydomain.*domain.tld/mydomain = jsj21020110.cn/' /etc/postfix/main.cf
sed -i 's/^#myorigin.*mydomain/myorigin = $mydomain/' /etc/postfix/main.cf
sed -i 's/^#inet_interfaces.*all/inet_interfaces = all/' /etc/postfix/main.cf
sed -i 's/^inet_interfaces.*localhost/#inet_interfaces = localhost/' /etc/postfix/main.cf
sed -i 's/^mydestination = $myhostname, localhost.$mydomain, localhost/mydestination = $myhostname, $mydomain, localhost/' /etc/postfix/main.cf

sed -i 's/^#protocols.*imap pop3 lmtp submission/protocols = imap pop3 lmtp/' /etc/dovecot/dovecot.conf
sed -i 's/^#login_trusted_networks.*/login_trusted_networks = 0.0.0.0\/0/' /etc/dovecot/dovecot.conf

sed -i 's/^#   mail_location = 
mbox:~\/mail:INBOX=\/var\/mail\/%u$/mail_location = mbox:~\/mail:INBOX=\/var\/mail\/%u/' /etc/dovecot/conf.d/10-mail.conf 

sed -i 's/^#disable_plaintext_auth = yes/disable_plaintext_auth = no/' /etc/dovecot/conf.d/10-auth.conf

sed -i 's/^ssl = required/ssl = no/' /etc/dovecot/conf.d/10-ssl.conf

useradd user1
useradd user2
echo "pa" | passwd --stdin user1 #配置用户名密码
echo "pa" | passwd --stdin user2 #配置用户名密码
mkdir -p /home/user1/mail/.imap/INBOX
mkdir -p /home/user2/mail/.imap/INBOX
chown user1.user1 -R /home/user1/ ; chown user2.user2 -R /home/user2/

systemctl restart postfix dovecot
systemctl enable postfix dovecot


客户端
dnf install -yq telnet-server telnet

telnet 172.21.7.1 25
helo jsj21020110.cn
mail from:"test"<user1@jsj21020110.cn>
rcpt to:user2@jsj21020110.cn
data
Teh first mail; user1 to user2
.
quit

telnet 172.21.7.1 110
user user2
pass pa
list
retr 1
quit
```

